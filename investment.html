<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>슈퍼문 로드맵 - 투자 수입</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Pretendard:wght@300;400;600;700;800&display=swap"
        rel="stylesheet">
    <style>
        body {
            font-family: 'Pretendard', sans-serif;
        }

        .glass-panel {
            background: rgba(30, 41, 59, 0.7);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.08);
        }

        .sidebar-link {
            transition: all 0.2s;
            cursor: pointer;
            text-decoration: none;
        }

        .sidebar-link:hover,
        .sidebar-link.active {
            background: rgba(59, 130, 246, 0.15);
            color: #60a5fa;
            border-right: 3px solid #60a5fa;
        }

        table {
            table-layout: fixed;
            width: max-content;
            min-width: 100%;
            border-spacing: 0;
        }

        th,
        td {
            vertical-align: middle !important;
            position: relative;
            padding: 0 !important;
            border: 1px solid rgba(255, 255, 255, 0.1);
            height: 1px;
            /* Trick to allow child height 100% */
            overflow: visible;
        }

        /* Flex centering wrapper inside table cell */
        .cell-wrapper {
            display: flex;
            align-items: center;
            /* Vertical Center */
            justify-content: center;
            /* Horizontal Center */
            width: 100%;
            height: 100%;
            min-height: 100%;
            box-sizing: border-box;
            padding: 0;
            margin: 0;
        }

        .table-input,
        .header-input,
        .row-header-input {
            background: transparent;
            width: 100%;
            height: auto;
            min-height: 0 !important;
            /* Allow shrinking below default height */
            text-align: center;
            color: inherit;
            border: 1px solid transparent;
            border-radius: 4px;
            font-variant-numeric: tabular-nums;
            white-space: pre-wrap;
            word-break: break-all;
            line-height: 1.4;
            display: inline-block;
            resize: none;
            overflow: hidden;
            box-sizing: border-box;
            padding: 4px 8px;
            margin: auto 0;
            font-family: inherit;
        }

        .table-input:focus {
            outline: none;
            background: rgba(255, 255, 255, 0.05);
            border-color: rgba(255, 255, 255, 0.2);
        }

        .header-input {
            font-weight: bold;
            color: #94a3b8;
        }

        .header-input:focus {
            outline: none;
            color: white;
        }

        .row-header-input {
            font-weight: bold;
            color: white;
        }

        .row-header-input:focus {
            outline: none;
            color: #60a5fa;
        }

        .resizer-v {
            position: absolute;
            right: 0;
            top: 0;
            width: 4px;
            height: 100%;
            cursor: col-resize;
            background: transparent;
            transition: background 0.2s;
            z-index: 10;
        }

        .resizer-v:hover {
            background: rgba(59, 130, 246, 0.4);
        }

        .resizer-h {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 4px;
            cursor: row-resize;
            background: transparent;
            transition: background 0.2s;
            z-index: 10;
        }

        .resizer-h:hover {
            background: rgba(59, 130, 246, 0.4);
        }

        .row-header-input:focus {
            outline: none;
            color: #60a5fa;
        }

        ::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: #475569;
            border-radius: 3px;
        }

        .row-completed {
            text-decoration: line-through;
            color: #ef4444 !important;
        }

        .row-completed textarea,
        .row-completed select,
        .row-completed .table-input {
            text-decoration: line-through;
            color: #ef4444 !important;
        }
    </style>
    <script> tailwind.config = { theme: { extend: { colors: { dark: '#0f172a', card: '#1e293b' } } } } </script>
</head>

<body class="bg-dark text-white min-h-screen flex flex-col lg:flex-row shadow-2xl relative overflow-x-hidden">
    <script src="sidebar.js"></script>
    <script>renderSidebar('investment');</script>

    <main class="flex-1 min-h-screen bg-dark p-4 lg:p-8 relative">
        <div class="w-full h-full space-y-8 pb-20">
            <div>
                <h2 id="pageTitle" class="text-3xl font-bold mb-2">투자 수입 관리</h2>
                <input type="text" id="pageSubtitle"
                    class="bg-transparent text-gray-400 text-sm focus:outline-none focus:text-white w-full max-w-2xl"
                    onchange="updateSubtitle(this.value)">
            </div>
            </header>

            <!-- Memo Container -->
            <div id="memoContainer" class="mt-1"></div>

            <!-- Block 1: General Investment Grid -->
            <div class="glass-panel rounded-2xl p-6">
                <div class="flex justify-between items-center mb-6">
                    <div class="flex items-center gap-2">
                        <span class="text-xl text-blue-400">📊</span>
                        <input type="text" id="titleBlock1"
                            class="bg-transparent text-xl font-bold focus:outline-none focus:text-blue-400 w-64"
                            onchange="updateBlockTitle('block1', this.value)">
                    </div>
                    <div class="flex gap-2">
                        <button onclick="copyGrid('block1')"
                            class="bg-gray-800/40 hover:bg-gray-700/60 px-3 py-1.5 rounded-lg text-xs font-bold transition text-gray-400 hover:text-white">📋
                            복사</button>
                        <button onclick="pasteGrid('block1')"
                            class="bg-blue-900/40 hover:bg-blue-900/60 px-3 py-1.5 rounded-lg text-xs font-bold transition text-blue-300">📥
                            붙여넣기</button>
                        <button onclick="openStructureManager('block1')"
                            class="bg-gray-700 hover:bg-gray-600 px-3 py-1.5 rounded-lg text-xs font-bold transition">⚙️
                            구조 및 색상 관리</button>
                        <button onclick="addColumn('block1')"
                            class="bg-blue-900/40 hover:bg-blue-900/60 px-3 py-1.5 rounded-lg text-xs font-bold transition text-blue-300">＋
                            열 추가</button>
                        <button onclick="addRow('block1')"
                            class="bg-blue-600 hover:bg-blue-500 px-3 py-1.5 rounded-lg text-xs font-bold transition">＋
                            행 추가</button>
                    </div>
                </div>
                <div class="overflow-x-auto rounded-xl border border-white/5">
                    <table class="w-full text-sm border-collapse" id="tableBlock1">
                        <!-- Rendered by JS -->
                    </table>
                </div>
            </div>

            <!-- Block 2: Investor Specific Grid -->
            <div class="glass-panel rounded-2xl p-6">
                <div class="flex justify-between items-center mb-6">
                    <div class="flex items-center gap-4">
                        <div class="flex items-center gap-2">
                            <span class="text-xl text-purple-400">👤</span>
                            <input type="text" id="titleBlock2"
                                class="bg-transparent text-xl font-bold focus:outline-none focus:text-purple-400 w-64"
                                onchange="updateBlockTitle('block2', this.value)">
                        </div>

                        <!-- Year Selector -->
                        <div class="flex items-center gap-1 bg-gray-800 rounded-lg p-1 border border-white/10">
                            <button onclick="changeYear(-1)"
                                class="w-6 h-6 flex items-center justify-center hover:bg-white/10 rounded text-gray-400 hover:text-white transition">◀</button>
                            <span id="currentYearDisplay" class="text-sm font-bold px-2 w-12 text-center">2026</span>
                            <button onclick="changeYear(1)"
                                class="w-6 h-6 flex items-center justify-center hover:bg-white/10 rounded text-gray-400 hover:text-white transition">▶</button>
                        </div>

                        <div class="flex items-center bg-gray-800 rounded-lg p-1 border border-white/10">
                            <select id="investorSelect" onchange="changeInvestor(this.value)"
                                class="bg-transparent text-sm font-bold px-3 py-1 focus:outline-none">
                                <!-- Options by JS -->
                            </select>
                        </div>

                        <button onclick="openInvestorManager()"
                            class="text-gray-500 hover:text-white transition text-xs">⚙️
                            투자자 관리</button>
                    </div>
                    <div class="flex gap-2">
                        <button onclick="copyGrid('block2')"
                            class="bg-gray-800/40 hover:bg-gray-700/60 px-3 py-1.5 rounded-lg text-xs font-bold transition text-gray-400 hover:text-white">📋
                            복사</button>
                        <button onclick="pasteGrid('block2')"
                            class="bg-purple-900/40 hover:bg-purple-900/60 px-3 py-1.5 rounded-lg text-xs font-bold transition text-purple-300">📥
                            붙여넣기</button>
                        <button onclick="openStructureManager('block2')"
                            class="bg-gray-700 hover:bg-gray-600 px-3 py-1.5 rounded-lg text-xs font-bold transition">⚙️
                            구조 및 색상 관리</button>
                        <button onclick="addColumn('block2')"
                            class="bg-purple-900/40 hover:bg-purple-900/60 px-3 py-1.5 rounded-lg text-xs font-bold transition text-purple-300">＋
                            열 추가</button>
                        <button onclick="addRow('block2')"
                            class="bg-purple-600 hover:bg-purple-500 px-3 py-1.5 rounded-lg text-xs font-bold transition">＋
                            행 추가</button>
                    </div>
                </div>
                <div class="overflow-x-auto rounded-xl border border-white/5">
                    <table class="w-full text-sm border-collapse" id="tableBlock2">
                        <!-- Rendered by JS -->
                    </table>
                </div>
            </div>
        </div>
    </main>

    <!-- Investor Manager Modal -->
    <div id="investorModal" class="fixed inset-0 bg-black/50 hidden items-center justify-center z-[100]">
        <div class="bg-card glass-panel p-6 rounded-2xl w-[400px] shadow-2xl border border-white/10">
            <h3 class="text-xl font-bold mb-4">투자자 관리</h3>
            <div class="flex gap-2 mb-4">
                <input type="text" id="newInvestorInput" placeholder="새 투자자 이름"
                    class="flex-1 bg-gray-800 border-white/10 rounded-lg px-3 py-2 text-sm focus:outline-none focus:border-blue-500">
                <button onclick="addInvestor()"
                    class="bg-blue-600 hover:bg-blue-500 px-4 py-2 rounded-lg font-bold">추가</button>
            </div>
            <div id="investorList" class="space-y-2 max-h-60 overflow-y-auto mb-6">
                <!-- List by JS -->
            </div>
            <div class="flex justify-end">
                <button onclick="closeInvestorManager()" class="text-gray-400 hover:text-white text-sm">닫기</button>
            </div>
        </div>
    </div>


    <!-- Structure Manager Modal -->
    <div id="structureModal" class="fixed inset-0 bg-black/50 hidden items-center justify-center z-[100]">
        <div
            class="bg-card glass-panel p-6 rounded-2xl w-[600px] shadow-2xl border border-white/10 max-h-[90vh] flex flex-col">
            <h3 id="structureModalTitle" class="text-xl font-bold mb-4">표 구조 및 색상 관리</h3>

            <div class="flex gap-6 overflow-hidden flex-1">
                <!-- Row Management -->
                <div class="flex-1 flex flex-col">
                    <h4 class="text-sm font-bold text-blue-400 mb-2 px-1">행(Row) 관리</h4>
                    <div id="rowManagerList"
                        class="flex-1 overflow-y-auto space-y-2 border border-white/5 rounded-lg p-2 bg-black/20">
                    </div>
                </div>
                <!-- Col Management -->
                <div class="flex-1 flex flex-col">
                    <h4 class="text-sm font-bold text-purple-400 mb-2 px-1">열(Column) 관리</h4>
                    <div id="colManagerList"
                        class="flex-1 overflow-y-auto space-y-2 border border-white/5 rounded-lg p-2 bg-black/20">
                    </div>
                </div>
            </div>

            <div class="flex justify-end mt-6">
                <button onclick="closeStructureManager()"
                    class="bg-blue-600 hover:bg-blue-500 text-white px-6 py-2 rounded-lg font-bold transition">완료</button>
            </div>
        </div>
    </div> <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="firebase_init.js"></script>


    <script src="data.js"></script>
    <script src="investment.js"></script>
    <script>
        window.addEventListener('load', () => {
            window.currentPageType = 'investment';
            if (typeof renderPageTitle === 'function') renderPageTitle('investment');
        });
    </script>
</body>

</html>